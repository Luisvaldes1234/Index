<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Aqualink</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src="dashboard.js" defer></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 text-gray-900">
  <div class="flex min-h-screen">
    <!-- Sidebar -->
    <aside class="w-64 bg-white shadow-md p-4 space-y-4">
      <h1 class="text-xl font-bold mb-6">Aqualink Dashboard</h1>
      <nav class="space-y-2">
        <button onclick="mostrarSeccion('resumen')" class="block w-full text-left hover:text-blue-600">游늵 Resumen</button>
        <button onclick="mostrarSeccion('litros')" class="block w-full text-left hover:text-blue-600">游눦 Litros Vendidos</button>
        <button onclick="mostrarSeccion('config')" class="block w-full text-left hover:text-blue-600">丘뙖잺 Configuraci칩n Remota</button>
        <button onclick="mostrarSeccion('historial')" class="block w-full text-left hover:text-blue-600">游 Historial</button>
      </nav>
    </aside>

    <!-- Contenido principal -->
    <main class="flex-1 p-6">

      <!-- Secci칩n: Resumen -->
      <section id="resumen">
        <h2 class="text-2xl font-semibold mb-4">Resumen de Ventas</h2>

        <!-- Filtros existentes -->
        <div class="flex space-x-4 mb-4">
          <select id="filtroMaquina" class="border rounded p-2">
            <option value="">Todas las m치quinas</option>
          </select>
          <select id="filtroPeriodo" class="border rounded p-2">
            <option value="dia">Hoy</option>
            <option value="semana">Esta semana</option>
            <option value="mes">Este mes</option>
            <option value="anio">Este a침o</option>
          </select>
          <button onclick="cargarResumen()" class="bg-blue-600 text-white px-4 py-2 rounded">Actualizar</button>
        </div>

        <!-- Cuadros resumen -->
        <div id="resumenDatos" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
          <div class="bg-white p-4 rounded shadow">
            <p class="text-gray-500">Ventas Totales</p>
            <p id="ventasTotales" class="text-xl font-bold">$0</p>
          </div>
           <div class="bg-white p-4 rounded shadow">
            <p class="text-gray-500">Litros Vendidos</p>
            <p id="litrosTotales" class="text-xl font-bold">0 L</p>
          </div>
          <div class="bg-white p-4 rounded shadow">
            <p class="text-gray-500">Compras por Volumen</p>
            <ul id="volumenesVendidos" class="text-sm space-y-1"></ul>
          </div>
        </div>

        <!-- NUEVO: Filtros personalizados por fecha -->
        <div class="mb-6 space-x-4">
          <label class="font-semibold">Filtrar por per칤odo:</label>
          <input type="date" id="fechaInicioResumen" class="border p-1">
          <input type="date" id="fechaFinResumen" class="border p-1">
          <button onclick="actualizarResumen()" class="bg-blue-500 text-white px-3 py-1 rounded">Aplicar</button>
        </div>

        <!-- NUEVO: Gr치fica de Ventas por m치quina -->
        <div class="bg-white shadow rounded p-4 mb-6">
          <h2 class="text-lg font-semibold mb-2">Ventas por m치quina</h2>
          <canvas id="graficaVentasMaquina" height="150"></canvas>
        </div>

        <!-- NUEVO: Gr치fica de Ventas por horario -->
        <div class="bg-white shadow rounded p-4">
          <h2 class="text-lg font-semibold mb-2">Ventas por horario</h2>
          <canvas id="graficaHorarios" height="150"></canvas>
        </div>
      </section>

      <!-- Secci칩n: Litros -->
      <section id="litros" class="hidden">
        <h2 class="text-2xl font-semibold mb-4">An치lisis de Litros Vendidos</h2>
        <div id="filtrosMaquinasGrafico" class="mb-4 space-x-4"></div>
        <canvas id="graficoLitros" width="400" height="200"></canvas>
      </section>

      <!-- Secci칩n: Configuraci칩n -->
      <section id="config" class="hidden">
        <h2 class="text-2xl font-semibold mb-4">Configuraci칩n Remota</h2>
        <form id="formConfig" class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label class="block">Bot칩n 1 (litros):</label>
            <input type="number" name="btn1_litros" class="w-full border p-2 rounded" />
          </div>
          <div>
            <label class="block">Bot칩n 1 (precio):</label>
            <input type="number" name="btn1_precio" class="w-full border p-2 rounded" />
          </div>
          <div class="md:col-span-3">
            <button type="button" onclick="guardarConfiguracion()" class="bg-green-600 text-white px-4 py-2 rounded">Guardar Cambios</button>
          </div>
        </form>
      </section>

      <!-- Secci칩n: Historial -->
      <section id="historial" class="hidden">
        <h2 class="text-2xl font-semibold mb-4">Historial de Ventas</h2>
        <div class="flex items-center space-x-4 mb-4">
          <select id="filtroHistorialPeriodo" class="border p-2 rounded">
            <option value="mes">Este mes</option>
            <option value="anio">Este a침o</option>
            <option value="todo">Todo el historial</option>
          </select>
          <button onclick="exportarHistorialCSV()" class="bg-green-600 text-white px-4 py-2 rounded">游닋 Exportar CSV</button>
        </div>
        <div id="tablaHistorial" class="overflow-auto bg-white rounded shadow p-4">
          <!-- Aqu칤 ir치 la tabla -->
        </div>
      </section>

    </main>
  </div>
</body>
</html>
